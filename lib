local MatexLib = {}

function MatexLib:CreateWindow(title)
    -- Services & player
    local plr = game.Players.LocalPlayer
    local char = plr.Character or plr.CharacterAdded:Wait()

    -- GUI setup
    local MatexUI = Instance.new("ScreenGui")
    MatexUI.ResetOnSpawn = false
    MatexUI.IgnoreGuiInset = true
    MatexUI.Name = "MatexUI"
    MatexUI.Parent = plr:WaitForChild("PlayerGui")

    local MatexFrame = Instance.new("Frame")
    MatexFrame.Name = "MatexFrame"
    MatexFrame.Size = UDim2.new(0, 350, 0, 200)
    MatexFrame.Position = UDim2.new(0, 150, 0, 100)
    MatexFrame.BackgroundColor3 = Color3.fromRGB(64, 64, 64)
    MatexFrame.BorderSizePixel = 2
    MatexFrame.Draggable = true
    MatexFrame.Active = true
    MatexFrame.Parent = MatexUI
    Instance.new("UICorner", MatexFrame).CornerRadius = UDim.new(0, 2)

    local HubLabel = Instance.new("TextLabel", MatexFrame)
    HubLabel.Size = UDim2.new(0, 100, 0, 20)
    HubLabel.Position = UDim2.new(0, 5, 0, 0)
    HubLabel.BackgroundTransparency = 1
    HubLabel.TextColor3 = Color3.new(1, 1, 1)
    HubLabel.TextStrokeColor3 = Color3.fromRGB(0, 127, 0)
    HubLabel.TextScaled = true
    HubLabel.Text = title or "Matex Hub"

    local X = Instance.new("TextButton", MatexFrame)
    X.Size = UDim2.new(0, 20, 0, 20)
    X.Position = UDim2.new(0, 329, 0, 1)
    X.BackgroundColor3 = Color3.fromRGB(162, 162, 162)
    X.BackgroundTransparency = 0.899
    X.TextColor3 = Color3.fromRGB(255, 0, 0)
    X.TextScaled = true
    X.Text = "X"
    Instance.new("UICorner", X)

    X.MouseButton1Click:Connect(function()
        MatexUI:Destroy()
    end)

    local ScrollFrame = Instance.new("ScrollingFrame", MatexFrame)
    ScrollFrame.Name = "ScrollFrame"
    ScrollFrame.Position = UDim2.new(0, 5, 0, 20)
    ScrollFrame.Size = UDim2.new(0, 100, 0, 150)
    ScrollFrame.BackgroundColor3 = Color3.fromRGB(162, 162, 162)
    ScrollFrame.BorderSizePixel = 2
    ScrollFrame.ScrollBarThickness = 4
    ScrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    ScrollFrame.ClipsDescendants = true

    local layout = Instance.new("UIListLayout", ScrollFrame)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 5)

    local ContentFrame = Instance.new("Frame", MatexFrame)
    ContentFrame.Name = "SelectedTab"
    ContentFrame.Position = UDim2.new(0, 120, 0, 20)
    ContentFrame.Size = UDim2.new(0, 200, 0, 150)
    ContentFrame.BackgroundColor3 = Color3.fromRGB(162, 162, 162)
    ContentFrame.BorderSizePixel = 2

    -- Player image
    local userId = plr.UserId
    local content = game.Players:GetUserThumbnailAsync(userId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100)
    local avatarImage = Instance.new("ImageLabel", MatexFrame)
    avatarImage.Name = "PlayerImage"
    avatarImage.Size = UDim2.new(0, 35, 0, 35)
    avatarImage.Position = UDim2.new(0, 5, 1, -45)
    avatarImage.Image = content
    avatarImage.BackgroundColor3 = Color3.new(1, 1, 1)
    avatarImage.BorderSizePixel = 1
    avatarImage.ScaleType = Enum.ScaleType.Fit
    Instance.new("UICorner", avatarImage).CornerRadius = UDim.new(1, 0)

    -- Return tab creator
    local window = {}

    function window:CreateTab(name)
        local tabBtn = Instance.new("TextButton", ScrollFrame)
        tabBtn.Size = UDim2.new(1, -10, 0, 30)
        tabBtn.Text = name
        tabBtn.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        tabBtn.TextColor3 = Color3.new(0, 0, 0)
        tabBtn.BorderSizePixel = 0
        tabBtn.Name = name

        local tabContent = Instance.new("Frame")
        tabContent.Name = name .. "_Content"
        tabContent.Parent = ContentFrame
        tabContent.BackgroundTransparency = 1
        tabContent.Size = UDim2.new(1, 0, 1, 0)
        tabContent.Visible = false

        local contentLayout = Instance.new("UIListLayout", tabContent)
        contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
        contentLayout.Padding = UDim.new(0, 5)

        tabBtn.MouseButton1Click:Connect(function()
            for _, t in pairs(ContentFrame:GetChildren()) do
                if t:IsA("Frame") then t.Visible = false end
            end
            tabContent.Visible = true
        end)

        local tab = {}

        function tab:CreateButton(text, callback)
            local btn = Instance.new("TextButton", tabContent)
            btn.Size = UDim2.new(1, 150, 0, 30)
            btn.Position = UDim2.new(0.5, 0, 0)
            btn.AnchorPoint = Vector2.new(0.5, 0)
            btn.Text = text
            btn.BackgroundColor3 = Color3.fromRGB(64, 64, 64)
            btn.TextColor3 = Color3.new(0, 0, 0)
            btn.BorderSizePixel = 0
            btn.MouseButton1Click:Connect(function()
                pcall(callback)
            end)
        end

        return tab
    end

    return window
end

return MatexLib
